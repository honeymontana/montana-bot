# Montana Bot Dashboard - –§–∏–Ω–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

## –ß—Ç–æ –≥–æ—Ç–æ–≤–æ ‚úÖ

1. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** —Å –∏—Å—Ç–æ—Ä–∏–µ–π –ø–æ–¥–ø–∏—Å–æ–∫ –∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ CHURN
2. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ** –Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏ Montana.dll (–∫–∞–Ω–∞–ª) –∏ –¥—Ä—É–≥–∏–µ —Ç–æ–≤–∞—Ä—ã
3. **–í–µ–±-–¥–∞—à–±–æ—Ä–¥** —Å –∫—Ä–∞—Å–∏–≤–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –∏ –≥—Ä–∞—Ñ–∏–∫–∞–º–∏
4. **API** –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
5. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** —á–µ—Ä–µ–∑ Python —Å–∫—Ä–∏–ø—Ç—ã
6. **3,154 —Å–æ–±—ã—Ç–∏–π** —É–∂–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏–∑ Telegram

---

## –¢–µ–∫—É—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –ö–∞–Ω–∞–ª Montana.dll
- **‚Ç¨1.00**: 1 –ø–æ–¥–ø–∏—Å—á–∏–∫
- **‚Ç¨3.00**: 249 –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
- **‚Ç¨4.00**: 12 –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
- **‚Ç¨5.00**: 1,017 –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ ‚≠ê
- **‚Ç¨9.00**: 199 –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤

**–í—Å–µ–≥–æ –ø–æ –∫–∞–Ω–∞–ª—É: 1,478 –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤**

### –î—Ä—É–≥–∏–µ —Ç–æ–≤–∞—Ä—ã
- ‚Ç¨19 - ‚Ç¨99: 90 –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π

---

## –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø

### –û—Ç–∫—Ä—ã—Ç—å –¥–∞—à–±–æ—Ä–¥
```bash
http://localhost:3000
```

API –∫–ª—é—á: `montana-secret-key-2026`

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –¥–∞—à–±–æ—Ä–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç
```bash
curl -H "X-API-Key: montana-secret-key-2026" \
  http://localhost:3000/api/metrics/overview
```

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–∞

### 1. –û—Ç–∫—Ä–æ–π http://localhost:3000

–¢—ã —É–≤–∏–¥–∏—à—å:
- **4 –∫–∞—Ä—Ç–æ—á–∫–∏** —Å –æ–±—â–∏–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
- **–í–∫–ª–∞–¥–∫–∏ "–ö–∞–Ω–∞–ª Montana.dll"** –∏ "–î—Ä—É–≥–∏–µ —Ç–æ–≤–∞—Ä—ã"
- **–ì—Ä–∞—Ñ–∏–∫–∏** CHURN –∏ –¥–æ—Ö–æ–¥–æ–≤
- **–¢–∞–±–ª–∏—Ü—ã** –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–∞–º–∏** –±–æ—Ç–∞

### 2. –í–∫–ª–∞–¥–∫–∞ "–ö–∞–Ω–∞–ª Montana.dll"

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- CHURN –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º ‚Ç¨1, ‚Ç¨3, ‚Ç¨5, ‚Ç¨9
- –°–∫–æ–ª—å–∫–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –∞–∫—Ç–∏–≤–Ω—ã—Ö/–æ—Ç–º–µ–Ω–∏–ª–∏
- –°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–ª–µ–Ω–∏–π
- –û–±—â–∏–π –¥–æ—Ö–æ–¥ –ø–æ –∫–∞–∂–¥–æ–º—É —Ç–∞—Ä–∏—Ñ—É

### 3. –í–∫–ª–∞–¥–∫–∞ "–î—Ä—É–≥–∏–µ —Ç–æ–≤–∞—Ä—ã"

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ç–æ–≤–∞—Ä–∞–º (‚Ç¨19+)
- –û—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –ø–æ–¥–ø–∏—Å–æ–∫ –Ω–∞ –∫–∞–Ω–∞–ª

---

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –í—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ)

```bash
# –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —ç–∫—Å–ø–æ—Ä—Ç–∞ Telegram
python3 scripts/import_telegram_export.py
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (cron)

–î–æ–±–∞–≤—å –≤ crontab:
```bash
crontab -e
```

–í—Å—Ç–∞–≤—å:
```cron
# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00
0 3 * * * cd /Users/nick/montana-tg-bot && python3 scripts/auto_sync.py >> /tmp/montana-sync.log 2>&1
```

–ü—Ä–æ–≤–µ—Ä—å:
```bash
python3 scripts/auto_sync.py
tail -f /tmp/montana-sync.log
```

---

## API Endpoints (–ø—Ä–∏–º–µ—Ä—ã)

### –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫–∞–Ω–∞–ª—É
```bash
curl -H "X-API-Key: montana-secret-key-2026" \
  http://localhost:3000/api/metrics/overview \
  | jq '.by_amount[] | select(.product_type == "channel")'
```

### –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–ø-10 —Å–∞–º—ã—Ö —Ü–µ–Ω–Ω—ã—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
```bash
curl -H "X-API-Key: montana-secret-key-2026" \
  "http://localhost:3000/api/metrics/subscribers?limit=10" \
  | jq '.subscribers | sort_by(.lifetime_value) | reverse | .[] | {user_id, ltv: .lifetime_value}'
```

### CHURN –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
```bash
curl -H "X-API-Key: montana-secret-key-2026" \
  "http://localhost:3000/api/metrics/churn-history?days=7&amount=5"
```

### –î–æ—Ö–æ–¥—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü
```bash
curl -H "X-API-Key: montana-secret-key-2026" \
  "http://localhost:3000/api/metrics/revenue?days=30"
```

---

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∞—à–±–æ—Ä–¥
```bash
node dashboard_server.js
```

### –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ —Ñ–æ–Ω–µ
```bash
nohup node dashboard_server.js > /tmp/dashboard.log 2>&1 &
```

### –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
```bash
pkill -f "node dashboard_server.js"
```

### –° Docker
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å—ë
docker-compose up -d

# –¢–æ–ª—å–∫–æ –¥–∞—à–±–æ—Ä–¥
docker-compose up -d postgres dashboard

# –õ–æ–≥–∏
docker-compose logs -f dashboard

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
docker-compose stop dashboard
```

---

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –Ω–æ–≤–æ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞

–ö–æ–≥–¥–∞ –ø–æ–ª—É—á–∏—à—å –Ω–æ–≤—ã–π —ç–∫—Å–ø–æ—Ä—Ç –∏–∑ Telegram:

```bash
# 1. –û–±–Ω–æ–≤–∏ –ø—É—Ç—å –≤ —Å–∫—Ä–∏–ø—Ç–µ
nano scripts/import_telegram_export.py
# –ò–∑–º–µ–Ω–∏ EXPORT_FILE –Ω–∞ –ø—É—Ç—å –∫ –Ω–æ–≤–æ–º—É result.json

# 2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π
python3 scripts/import_telegram_export.py

# 3. –û–±–Ω–æ–≤–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–∞—à–±–æ—Ä–¥–∞
# –ú–µ—Ç—Ä–∏–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—é—Ç—Å—è
```

---

## –ü—Ä–æ–¥–∞–∫—à–Ω

### Nginx (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –≤–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø)
```nginx
server {
    listen 80;
    server_name dashboard.montana.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### Systemd (–∞–≤—Ç–æ–∑–∞–ø—É—Å–∫)
```bash
sudo nano /etc/systemd/system/montana-dashboard.service
```

```ini
[Unit]
Description=Montana Dashboard
After=network.target

[Service]
Type=simple
User=nick
WorkingDirectory=/Users/nick/montana-tg-bot
ExecStart=/usr/bin/node dashboard_server.js
Restart=always

[Install]
WantedBy=multi-user.target
```

```bash
sudo systemctl enable montana-dashboard
sudo systemctl start montana-dashboard
```

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –°–º–µ–Ω–∏—Ç—å API –∫–ª—é—á
```bash
# –í .env
echo "DASHBOARD_API_KEY=$(openssl rand -hex 32)" >> .env

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é
export DASHBOARD_API_KEY="—Ç–≤–æ–π-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á"
node dashboard_server.js
```

### –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø
```bash
# –¢–æ–ª—å–∫–æ —Å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ IP
sudo ufw allow from 192.168.1.0/24 to any port 3000
```

---

## –§–∞–π–ª—ã

```
montana-tg-bot/
‚îú‚îÄ‚îÄ dashboard_server.js              # –í–µ–±-—Å–µ—Ä–≤–µ—Ä –¥–∞—à–±–æ—Ä–¥–∞
‚îú‚îÄ‚îÄ dashboard/dist/index.html        # HTML –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ import_telegram_export.py   # –ò–º–ø–æ—Ä—Ç –∏–∑ Telegram
‚îÇ   ‚îú‚îÄ‚îÄ auto_sync.py                # –ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ crontab.example             # –ü—Ä–∏–º–µ—Ä—ã cron
‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îú‚îÄ‚îÄ 006_add_subscription_analytics.sql
‚îÇ   ‚îî‚îÄ‚îÄ 007_add_product_type.sql
‚îú‚îÄ‚îÄ QUICK_START.md
‚îú‚îÄ‚îÄ DASHBOARD_GUIDE.md
‚îî‚îÄ‚îÄ analyze_subscriptions.py         # –ü–µ—Ä–≤—ã–π –∞–Ω–∞–ª–∏–∑ (–Ω–µ –Ω—É–∂–µ–Ω –±–æ–ª—å—à–µ)
```

---

## –ß—Ç–æ –¥–∞–ª—å—à–µ?

1. ‚úÖ –î–∞—à–±–æ—Ä–¥ –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
2. ‚úÖ –î–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã (3,154 —Å–æ–±—ã—Ç–∏—è)
3. ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –∫–∞–Ω–∞–ª –∏ —Ç–æ–≤–∞—Ä—ã —Ä–∞–±–æ—Ç–∞–µ—Ç
4. üîÑ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å cron –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
5. üåê (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ—Å—Ç—É–ø –∏–∑–≤–Ω–µ —á–µ—Ä–µ–∑ nginx
6. üîí (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –°–º–µ–Ω–∏—Ç—å API –∫–ª—é—á –Ω–∞ –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π

---

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î
docker exec montana-postgres psql -U montana -d montana_bot -c "SELECT COUNT(*) FROM subscription_events;"

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ
docker exec montana-postgres psql -U montana -d montana_bot -c "SELECT product_type, COUNT(*) FROM subscription_events GROUP BY product_type;"

# –¢–æ–ø –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ –ø–æ LTV
docker exec montana-postgres psql -U montana -d montana_bot -c "SELECT user_id, lifetime_value FROM user_subscription_stats ORDER BY lifetime_value DESC LIMIT 10;"

# –û–±–Ω–æ–≤–∏—Ç—å –∞–Ω–∞–ª–∏–∑
python3 scripts/import_telegram_export.py
```

---

**üéâ –ì–æ—Ç–æ–≤–æ! –î–∞—à–±–æ—Ä–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**

–û—Ç–∫—Ä—ã–≤–∞–π **http://localhost:3000** –∏ –Ω–∞—Å–ª–∞–∂–¥–∞–π—Å—è –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π!
