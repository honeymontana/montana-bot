# Montana Bot Dashboard - ะัััััะน ััะฐัั

## ะงัะพ ะฟะพะปััะธะปะพัั

ะกะพะทะดะฐะฝะฐ **ะฟะพะปะฝะพัะตะฝะฝะฐั ัะธััะตะผะฐ ัะฟัะฐะฒะปะตะฝะธั** Montana Bot ั:

1. โ **ะะฒัะพะผะฐัะธัะตัะบะฐั ัะธะฝััะพะฝะธะทะฐัะธั** ะดะฐะฝะฝัั ะธะท Tribute
2. โ **ะะฐะทะฐ ะดะฐะฝะฝัั** ั ะธััะพัะธะตะน ะฒัะตั ะฟะพะดะฟะธัะพะบ ะธ ะผะตััะธะบ
3. โ **ะะตะฑ-ะดะฐัะฑะพัะด** ั ะบัะฐัะธะฒัะผะธ ะณัะฐัะธะบะฐะผะธ ะธ ะฐะฝะฐะปะธัะธะบะพะน
4. โ **API** ะดะปั ะฟัะพะณัะฐะผะผะฝะพะณะพ ะดะพัััะฟะฐ ะบ ะดะฐะฝะฝัะผ
5. โ **CHURN ะฐะฝะฐะปะธะท** ะฟะพ ะดะฐัะฐะผ ะธ ััะผะผะฐะผ ะฟะพะดะฟะธัะพะบ
6. โ **ะฃะฟัะฐะฒะปะตะฝะธะต ะณััะฟะฟะฐะผะธ** ัะตัะตะท ะฒะตะฑ-ะธะฝัะตััะตะนั

---

## ะจะฐะณ 1: ะัะธะผะตะฝะธัั ะผะธะณัะฐัะธะธ ะะ

```bash
# ะัะธะผะตะฝะธัั ะฝะพะฒัะต ัะฐะฑะปะธัั ะดะปั ะฐะฝะฐะปะธัะธะบะธ
npm run migration:run

# ะัะพะฒะตัะธัั, ััะพ ัะฐะฑะปะธัั ัะพะทะดะฐะฝั
docker-compose exec postgres psql -U montana -d montana_bot -c "\dt"
```

ะั ะดะพะปะถะฝั ัะฒะธะดะตัั ะฝะพะฒัะต ัะฐะฑะปะธัั:
- `subscription_events`
- `churn_metrics`
- `user_subscription_stats`

---

## ะจะฐะณ 2: ะะผะฟะพััะธัะพะฒะฐัั ะธััะพัะธัะตัะบะธะต ะดะฐะฝะฝัะต

**ะะฐัะธะฐะฝั A: ะงะตัะตะท Python ัะบัะธะฟั**

```bash
# ะะตัะฒัะน ะธะผะฟะพัั - ะธัะฟะพะปัะทัะนัะต ะฒะฐั Python ัะบัะธะฟั
python3 analyze_subscriptions.py
```

**ะะฐัะธะฐะฝั B: ะงะตัะตะท API ะฟะพัะปะต ะทะฐะฟััะบะฐ ะดะฐัะฑะพัะดะฐ** (ัะตะบะพะผะตะฝะดัะตััั)

ะกะฝะฐัะฐะปะฐ ะทะฐะฟัััะธัะต ะดะฐัะฑะพัะด (ัะผ. ะจะฐะณ 3), ะทะฐัะตะผ:

```bash
curl -X POST \
  -H "X-API-Key: montana-secret-key-2026" \
  -H "Content-Type: application/json" \
  -d '{"file_path": "/Users/nick/Downloads/Telegram Desktop/ChatExport_2026-02-12 (1)/result.json"}' \
  http://localhost:3000/api/import/tribute-export
```

---

## ะจะฐะณ 3: ะะฐะฟัััะธัั ะดะฐัะฑะพัะด

### ะะพะบะฐะปัะฝะพ (ัะฐะทัะฐะฑะพัะบะฐ)

```bash
# ะะฐะฟัััะธัั ัะพะปัะบะพ ะดะฐัะฑะพัะด
npm run dashboard
```

ะัะบัะพะนัะต ะฑัะฐัะทะตั: **http://localhost:3000**

### ะก Docker (ะฟัะพะดะฐะบัะฝ)

```bash
# ะะฐะฟัััะธัั ะฒัั (ะฑะพั + ะดะฐัะฑะพัะด + ะะ)
docker-compose up -d

# ะะปะธ ัะพะปัะบะพ ะดะฐัะฑะพัะด + ะะ
docker-compose up -d postgres dashboard

# ะะพัะผะพััะตัั ะปะพะณะธ
docker-compose logs -f dashboard
```

---

## ะจะฐะณ 4: ะัะบัััั ะดะฐัะฑะพัะด ะธ ะฟัะพะฒะตัะธัั

1. ะัะบัะพะนัะต **http://localhost:3000**
2. ะั ะดะพะปะถะฝั ัะฒะธะดะตัั:
   - ๐ 4 ะบะฐััะพัะบะธ ั ะผะตััะธะบะฐะผะธ (ะัะตะณะพ ะฟะพะดะฟะธััะธะบะพะฒ, ะะบัะธะฒะฝัั, ะะพัะพะด, ะกัะตะดะฝะตะต ะฟัะพะดะปะตะฝะธะน)
   - ๐ ะขะฐะฑะปะธัั CHURN ะฟะพ ััะผะผะฐะผ
   - ๐ ะัะฐัะธะบ CHURN ะทะฐ 30 ะดะฝะตะน
   - ๐ฐ ะัะฐัะธะบ ะดะพัะพะดะพะฒ
   - ๐ฅ ะกะฟะธัะพะบ ะฒัะตั ะฟะพะดะฟะธััะธะบะพะฒ
   - ๐๏ธ ะฃะฟัะฐะฒะปะตะฝะธะต ะณััะฟะฟะฐะผะธ

---

## ะจะฐะณ 5: ะะฐัััะพะธัั ะฐะฒัะพะผะฐัะธัะตัะบัั ัะธะฝััะพะฝะธะทะฐัะธั

### ะะฐัะธะฐะฝั A: Cron job (ัะตะบะพะผะตะฝะดัะตััั)

```bash
# ะััะตะดะฐะบัะธัะพะฒะฐัั crontab
crontab -e

# ะะพะฑะฐะฒะธัั ะทะฐะดะฐัั (ัะธะฝััะพะฝะธะทะฐัะธั ะบะฐะถะดัะน ะดะตะฝั ะฒ 3:00)
0 3 * * * cd /Users/nick/montana-tg-bot && python3 scripts/auto_sync.py >> /tmp/montana-sync.log 2>&1

# ะะปะธ ะบะฐะถะดัะต 6 ัะฐัะพะฒ
0 */6 * * * cd /Users/nick/montana-tg-bot && python3 scripts/auto_sync.py >> /tmp/montana-sync.log 2>&1

# ะกะพััะฐะฝะธัั ะธ ะฒัะนัะธ
```

ะัะพะฒะตัะธัั, ััะพ cron ัะฐะฑะพัะฐะตั:
```bash
# ะะฐะฟัััะธัั ะฒัััะฝัั
python3 scripts/auto_sync.py

# ะะพัะผะพััะตัั ะปะพะณะธ
tail -f /tmp/montana-sync.log
```

### ะะฐัะธะฐะฝั B: Systemd timer

```bash
# ะกะพะทะดะฐัั ัะตัะฒะธั
sudo nano /etc/systemd/system/montana-sync.service
```

ะกะพะดะตัะถะธะผะพะต:
```ini
[Unit]
Description=Montana Bot Data Sync
After=network.target

[Service]
Type=oneshot
User=nick
WorkingDirectory=/Users/nick/montana-tg-bot
ExecStart=/usr/bin/python3 /Users/nick/montana-tg-bot/scripts/auto_sync.py
Environment=DASHBOARD_URL=http://localhost:3000
Environment=DASHBOARD_API_KEY=montana-secret-key-2026
```

ะกะพะทะดะฐัั ัะฐะนะผะตั:
```bash
sudo nano /etc/systemd/system/montana-sync.timer
```

ะกะพะดะตัะถะธะผะพะต:
```ini
[Unit]
Description=Montana Bot Data Sync Timer
Requires=montana-sync.service

[Timer]
OnCalendar=*-*-* 03:00:00
Persistent=true

[Install]
WantedBy=timers.target
```

ะะบัะธะฒะธัะพะฒะฐัั:
```bash
sudo systemctl daemon-reload
sudo systemctl enable montana-sync.timer
sudo systemctl start montana-sync.timer
sudo systemctl status montana-sync.timer
```

---

## ะจะฐะณ 6: (ะะฟัะธะพะฝะฐะปัะฝะพ) ะะฐัััะพะธัั Tribute Webhook

ะัะปะธ ั ะฒะฐั ะตััั ะดะพัััะฟ ะบ ะฝะฐัััะพะนะบะฐะผ Tribute:

1. ะัะบัะพะนัะต Tribute Dashboard
2. ะะตัะตะนะดะธัะต ะฒ Settings โ Webhooks
3. ะะพะฑะฐะฒััะต URL: `https://ะฒะฐั-ะดะพะผะตะฝ.com/api/webhooks/tribute`
4. ะัะฑะตัะธัะต ัะพะฑััะธั:
   - โ subscription.created
   - โ subscription.renewed
   - โ subscription.cancelled
5. ะกะพััะฐะฝะธัะต

ะขะตะฟะตัั ะฒัะต ะฝะพะฒัะต ัะพะฑััะธั ะฑัะดัั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะพะฟะฐะดะฐัั ะฒ ะดะฐัะฑะพัะด!

---

## ะงัะพ ะผะพะถะฝะพ ะดะตะปะฐัั ะฒ ะดะฐัะฑะพัะดะต

### ๐ ะัะพัะผะพัั ะผะตััะธะบ

- **ะะฑัะธะน CHURN** ะฟะพ ะฒัะตะผ ะฟะพะดะฟะธัะบะฐะผ
- **CHURN ะฟะพ ะบะฐะถะดะพะน ััะผะผะต** (โฌ1, โฌ3, โฌ5, โฌ9)
- **Retention Rate** - ะฟัะพัะตะฝั ัะดะตัะถะฐะฝะธั
- **ะกัะตะดะฝะตะต ะบะพะปะธัะตััะฒะพ ะฟัะพะดะปะตะฝะธะน** ะฝะฐ ะฟะพะปัะทะพะฒะฐัะตะปั
- **LTV (Lifetime Value)** ะดะปั ะบะฐะถะดะพะณะพ ะฟะพะดะฟะธััะธะบะฐ

### ๐ ะัะฐัะธะบะธ

- **CHURN ะฟะพ ะฒัะตะผะตะฝะธ** - ะบะฐะบ ะผะตะฝัะปัั churn ะทะฐ ะฟะพัะปะตะดะฝะธะต 30 ะดะฝะตะน
- **ะะพัะพะด ะฟะพ ะดะฝัะผ** - ัะบะพะปัะบะพ ะทะฐัะฐะฑะพัะฐะปะธ ะบะฐะถะดัะน ะดะตะฝั
- **ะกัะฐะฒะฝะตะฝะธะต ัะฐัะธัะพะฒ** - ะบะฐะบะพะน ัะฐัะธั ะฑะพะปะตะต ะฒัะณะพะดะตะฝ

### ๐ฅ ะะฐะฑะพัะฐ ั ะฟะพะดะฟะธััะธะบะฐะผะธ

- ะคะธะปััั ะฟะพ ััะผะผะต ะฟะพะดะฟะธัะบะธ
- ะคะธะปััั ะฟะพ ััะฐัััั (ะฐะบัะธะฒะฝัะต/ะพัะผะตะฝะธะปะธ)
- ะกะพััะธัะพะฒะบะฐ ะฟะพ LTV, ะดะฐัะต, ะบะพะปะธัะตััะฒั ะฟัะพะดะปะตะฝะธะน
- ะญะบัะฟะพัั ะฒ CSV (ัะตัะตะท API)

### ๐๏ธ ะฃะฟัะฐะฒะปะตะฝะธะต ะณััะฟะฟะฐะผะธ

- ะะพะฑะฐะฒะธัั ะฝะพะฒัั ะณััะฟะฟั
- ะฃะดะฐะปะธัั ะณััะฟะฟั
- ะะทะผะตะฝะธัั ัะธะฟ (ะพะฑััะฝะฐั/ะฟะพััะพัะฝะฝะฐั)
- ะะฐัััะพะธัั ะฒัะตะผั ะดะพัััะฟะฐ
- ะกะธะฝััะพะฝะธะทะธัะพะฒะฐัั ัะปะตะฝััะฒะพ

---

## ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั API

### ะะพะปััะธัั ัะพะฟ-10 ัะฐะผัั ัะตะฝะฝัั ะฟะพะดะฟะธััะธะบะพะฒ

```bash
curl -H "X-API-Key: montana-secret-key-2026" \
  "http://localhost:3000/api/metrics/subscribers?limit=10" \
  | jq '.subscribers | sort_by(.lifetime_value) | reverse | .[] | {user_id, ltv: .lifetime_value, renewals: .total_renewals}'
```

### ะะพััะธัะฐัั CHURN ะทะฐ ะฟะพัะปะตะดะฝัั ะฝะตะดะตะปั

```bash
curl -H "X-API-Key: montana-secret-key-2026" \
  "http://localhost:3000/api/metrics/churn-history?days=7" \
  | jq '[.[] | .churn_rate] | add / length'
```

### ะญะบัะฟะพััะธัะพะฒะฐัั ะฒัะตั ะฟะพะดะฟะธััะธะบะพะฒ ะฒ JSON

```bash
curl -H "X-API-Key: montana-secret-key-2026" \
  "http://localhost:3000/api/metrics/subscribers?limit=10000" \
  > subscribers.json
```

---

## ะัะพะฑะปะตะผั ะธ ัะตัะตะฝะธั

### ะะฐัะฑะพัะด ะฝะต ะทะฐะฟััะบะฐะตััั

```bash
# ะัะพะฒะตัะธัั ะปะพะณะธ
docker-compose logs dashboard

# ะัะพะฒะตัะธัั ะะ
docker-compose exec postgres psql -U montana -d montana_bot -c "SELECT NOW();"

# ะะตัะตัะพะฑัะฐัั ะพะฑัะฐะท
docker-compose build dashboard
docker-compose up -d dashboard
```

### ะะตั ะดะฐะฝะฝัั ะฒ ะดะฐัะฑะพัะดะต

```bash
# ะัะพะฒะตัะธัั, ััะพ ะดะฐะฝะฝัะต ะธะผะฟะพััะธัะพะฒะฐะฝั
docker-compose exec postgres psql -U montana -d montana_bot -c "SELECT COUNT(*) FROM subscription_events;"

# ะัะปะธ 0, ัะพ ะธะผะฟะพััะธัะพะฒะฐัั ะฒัััะฝัั
python3 scripts/auto_sync.py
```

### API ะฒะพะทะฒัะฐัะฐะตั 401 Unauthorized

ะัะพะฒะตัััะต, ััะพ ะธัะฟะพะปัะทัะตัะต ะฟัะฐะฒะธะปัะฝัะน API ะบะปัั:
```bash
echo $DASHBOARD_API_KEY
# ะะพะปะถะตะฝ ะฑััั: montana-secret-key-2026

# ะะปะธ ะธะทะผะตะฝะธัะต ะฒ .env
echo "DASHBOARD_API_KEY=ะฒะฐั-ะฝะพะฒัะน-ะบะปัั" >> .env
docker-compose restart dashboard
```

---

## ะกัััะบัััะฐ ัะฐะนะปะพะฒ

```
montana-tg-bot/
โโโ src/
โ   โโโ api/
โ   โ   โโโ DashboardAPI.ts          # API endpoints
โ   โโโ services/
โ   โ   โโโ TributeService.ts        # ะกะตัะฒะธั ัะฐะฑะพัั ั ะฟะพะดะฟะธัะบะฐะผะธ
โ   โโโ dashboard.ts                  # ะขะพัะบะฐ ะฒัะพะดะฐ ะดะฐัะฑะพัะดะฐ
โโโ dashboard/
โ   โโโ dist/
โ       โโโ index.html                # ะคัะพะฝัะตะฝะด ะดะฐัะฑะพัะดะฐ
โโโ migrations/
โ   โโโ 006_add_subscription_analytics.sql
โโโ scripts/
โ   โโโ auto_sync.py                  # ะะฒัะพัะธะฝััะพะฝะธะทะฐัะธั
โโโ analyze_subscriptions.py          # Python ัะบัะธะฟั ะฐะฝะฐะปะธะทะฐ
โโโ DASHBOARD_GUIDE.md                # ะะพะปะฝะพะต ััะบะพะฒะพะดััะฒะพ
โโโ QUICK_START.md                    # ะญัะพั ัะฐะนะป
```

---

## ะกะปะตะดัััะธะต ัะฐะณะธ

1. โ ะะผะฟะพััะธัะพะฒะฐัั ะธััะพัะธัะตัะบะธะต ะดะฐะฝะฝัะต
2. โ ะะฐะฟัััะธัั ะดะฐัะฑะพัะด ะธ ะฟัะพะฒะตัะธัั ะผะตััะธะบะธ
3. โ ะะฐัััะพะธัั ะฐะฒัะพะผะฐัะธัะตัะบัั ัะธะฝััะพะฝะธะทะฐัะธั
4. ๐ ะะฐัััะพะธัั webhook ะฒ Tribute (ะพะฟัะธะพะฝะฐะปัะฝะพ)
5. ๐ ะกะผะตะฝะธัั API ะบะปัั ะฝะฐ ะฟัะพะดะฐะบัะฝะต
6. ๐ ะะฐัััะพะธัั nginx + SSL ะดะปั ะฟัะพะดะฐะบัะฝะฐ
7. ๐ฑ ะะพะปััะฐัั ัะฒะตะดะพะผะปะตะฝะธั ะฒ Telegram (ะฑัะดััะฐั ัะธัะฐ)

---

## ะะพะปะตะทะฝัะต ะบะพะผะฐะฝะดั

```bash
# ะะฐะฟัััะธัั ะดะฐัะฑะพัะด ะปะพะบะฐะปัะฝะพ
npm run dashboard

# ะะฐะฟัััะธัั ั Docker
docker-compose up -d dashboard

# ะะพัะผะพััะตัั ะปะพะณะธ
docker-compose logs -f dashboard

# ะััะฐะฝะพะฒะธัั
docker-compose stop dashboard

# ะะผะฟะพััะธัะพะฒะฐัั ะดะฐะฝะฝัะต ะฒัััะฝัั
python3 scripts/auto_sync.py

# ะัะพะฒะตัะธัั ะะ
docker-compose exec postgres psql -U montana -d montana_bot

# ะะตัะตัะพะฑัะฐัั ะฟะพัะปะต ะธะทะผะตะฝะตะฝะธะน
docker-compose build dashboard
docker-compose up -d dashboard
```

---

**ะะพัะพะฒะพ! ะขะตะฟะตัั ั ะฒะฐั ะฟะพะปะฝะพัะตะฝะฝะฐั ัะธััะตะผะฐ ะฐะฝะฐะปะธัะธะบะธ ะธ ัะฟัะฐะฒะปะตะฝะธั Montana Bot!** ๐

ะัะบััะฒะฐะนัะต http://localhost:3000 ะธ ะฝะฐัะปะฐะถะดะฐะนัะตัั ะบัะฐัะธะฒะพะน ะฐะฝะฐะปะธัะธะบะพะน!
